# 개발 환경용 Docker Compose
# 소스 코드를 볼륨으로 마운트하여 코드 변경 시 자동 반영

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: construction-backend-dev
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=sqlite:///./data/test.db
      - SECRET_KEY=${SECRET_KEY:-dev-secret-key}
      - ENVIRONMENT=development
      - CORS_ORIGINS=http://localhost:80,http://localhost:5173,http://localhost:3000
      - ACCESS_TOKEN_EXPIRE_MINUTES=30
    volumes:
      - ./backend:/app
      - backend_data_dev:/app/data
    working_dir: /app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    restart: unless-stopped
    networks:
      - construction-network-dev

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: builder  # 개발 모드용
    container_name: construction-frontend-dev
    ports:
      - "5173:5173"  # Vite 개발 서버 포트
    volumes:
      - ./frontend:/app
      - /app/node_modules
    working_dir: /app
    command: pnpm dev --host
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - construction-network-dev
    environment:
      - VITE_API_URL=http://localhost:8000

volumes:
  backend_data_dev:

networks:
  construction-network-dev:
    driver: bridge

